---
apiVersion: v1
kind: Namespace
metadata:
  name: production
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: team
  namespace: production
  labels:
    app: team
spec:
  replicas: 1
  selector:
    matchLabels:
      app: team
  template:
    metadata:
      labels:
        app: team  # ì •í™•í•œ ë ˆì´ë¸”
    spec:
      # ë¬¸ì œ 1: ServiceAccount ëˆ„ë½ (redhat-sa í•„ìš”)
      containers:
      - name: httpd
        image: registry.access.redhat.com/ubi8/httpd-24:latest
        ports:
        - containerPort: 8080
          protocol: TCP
        - containerPort: 8443
          protocol: TCP
        securityContext:
          runAsUser: 0  # ë¬¸ì œ: Root ì‹¤í–‰ í•„ìš” â†’ anyuid SCC í•„ìš”
        volumeMounts:
        - name: config
          mountPath: /var/www/html
      volumes:
      - name: config
        configMap:
          name: team-config
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: team-config
  namespace: production
data:
  index.html: |
    <!DOCTYPE html>
    <html>
    <head>
      <title>Team Application</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
        }
        .container {
          text-align: center;
          background: rgba(255, 255, 255, 0.1);
          padding: 40px;
          border-radius: 10px;
          box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        h1 { font-size: 3em; margin: 0; }
        p { font-size: 1.5em; margin-top: 20px; }
      </style>
    </head>
    <body>
      <div class="container">
        <h1>ğŸ¯ Team Application</h1>
        <p>Successfully deployed on OpenShift!</p>
        <p>Running as UID: $(id -u)</p>
      </div>
    </body>
    </html>
---
apiVersion: v1
kind: Service
metadata:
  name: team
  namespace: production
  labels:
    app: team
spec:
  selector:
    app: teams  # ë¬¸ì œ 2: ì˜ëª»ëœ selector (teamì´ ì•„ë‹Œ teams)
  ports:
  - name: http
    port: 8080
    targetPort: 8443  # ë¬¸ì œ 3: ì˜ëª»ëœ targetPort (ì‹¤ì œ HTTPëŠ” 8080)
    protocol: TCP
  - name: https
    port: 8443
    targetPort: 8443
    protocol: TCP
  type: ClusterIP
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: team
  namespace: production
  labels:
    app: team
spec:
  to:
    kind: Service
    name: team
    weight: 100
  port:
    targetPort: http
  wildcardPolicy: None
